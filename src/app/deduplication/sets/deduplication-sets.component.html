<div class="container">
  <div class="row">
    <div class="col-12">
      <h2 id="header" class="border-bottom pb-2">
        Records duplicate Identifiers (DOI, PMID, ARXIV, SCOPUS, ISI)
      </h2>
      <p>
        The page shows potentially duplicate groups by signature. You can select
        the items to compare or reject. The system records the action "No
        duplicate" so the match is not show in the future.
      </p>
      <div
        *ngIf="
          (!sets$ || (sets$ | async)?.length == 0) && !(isSetsLoading() | async)
        "
        class="col-md-12 text-center"
      >
        <h4 class="signatures-not-found p-3">
          No sets found for this signature.
        </h4>
      </div>
      <ds-loading
        class="container"
        *ngIf="isSetsLoading() | async"
        message="'Loading...' | translate"
      ></ds-loading>
      <ngb-accordion
        [destroyOnHide]="false"
        [closeOthers]="true"
        activeIds="panel-0"
      >
        <ng-container *ngFor="let set of sets$ | async; let i = index">
          <ngb-panel id="panel-{{ i }}">
            <ng-template ngbPanelHeader let-opened="opened">
              <div class="row">
                <div class="col-md-10 mt-1">
                  <h5 class="m-0">
                    {{ set.id }}
                    <span class="badge badge-primary">
                      {{ (getItemsPerSet(set.id) | async)?.length }}
                    </span>
                  </h5>
                </div>
                <div class="col-md-2 text-right mt-1">
                  <button ngbPanelToggle class="btn btn-outline-info btn-sm">
                    <i class="fa fa-chevron-up"></i>
                  </button>
                </div>
              </div>
              <div class="row">
                <div class="col-12">
                  <hr />
                </div>
              </div>
              <div class="row">
                <div class="col-sm-4 col-md-3 col-lg-2">
                  <span class="badge badge-secondary small">Match other criteria</span>
                </div>
                <div class="col-sm-8 col-md-9 col-lg-10">
                  <ng-container *ngFor="let id of getItemIds(set.id) | async">
                    <span class="badge badge-info small"> {{ id }}</span>
                  </ng-container>
                </div>
              </div>
            </ng-template>
            <ng-template ngbPanelContent>
              <ng-container
                *ngIf="(getItemsPerSet(set.id) | async)?.length == 0"
              >
                No items found.
              </ng-container>
              <ng-container
                *ngIf="(getItemsPerSet(set.id) | async)?.length > 0"
              >
                <div class="row">
                  <div class="col-12">
                    <p class="small">Select the items to compare them.</p>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-4">
                    <button class="btn btn-outline-secondary btn-sm mt-1">
                      <i class="fa fa-check-square"></i> Select all
                    </button>
                    <button class="btn btn-outline-secondary btn-sm mt-1">
                      <i class="fa fa-square"></i> Deselect all
                    </button>
                  </div>
                  <div class="col-md-8 text-right">
                    <button class="btn btn-primary btn-sm mt-1">
                      <i class="fa fa-clone"></i> Compare
                    </button>
                    <button class="btn btn-outline-secondary btn-sm mt-1" (click)="noDuplicatesAction(set.id)">
                      <i class="fa fa-times"></i> No duplicates
                    </button>
                    <button
                      class="btn btn-outline-danger btn-sm mt-1"
                      *ngIf="isAdmin$ | async"
                      (click)="
                        $event.preventDefault();
                        confirmDelete(content, set.id, 'set', set.setChecksum)
                      "
                    >
                      <i class="fa fa-trash-alt"></i> Delete set
                    </button>
                  </div>
                </div>
                <div class="row mt-2">
                  <div class="col-12">
                    <div class="table-responsive">
                      <table class="table table-striped">
                        <tbody>
                          <ng-container
                            *ngFor="
                              let item of getItemsPerSet(set.id) | async"
                          >
                            <tr class="border border-thick">
                              <td>
                                <div
                                  class="custom-control custom-checkbox ml-0"
                                >
                                  <input
                                    type="checkbox"
                                    class="custom-control-input"
                                    [id]="item.uuid"
                                    (change)="
                                      onItemCheck($event, item.uuid, set.id)
                                    "
                                  />
                                  <label
                                    class="custom-control-label"
                                    [for]="item.uuid"
                                  ></label>
                                </div>
                              </td>
                              <td>
                                <table class="table table-borderless small">
                                  <tbody>
                                    <tr>
                                      <th>Collection:</th>
                                      <td>{{ item.entityType }}</td>
                                    </tr>
                                    <tr>
                                      <th>Internal identifier:</th>
                                      <td>
                                        <button
                                          class="btn btn-outline-secondary btn-sm"
                                        >
                                          {{ item.uuid }}
                                        </button>
                                      </td>
                                    </tr>
                                    <tr>
                                      <th>Last modified:</th>
                                      <td>{{ item.lastModified | date }}</td>
                                    </tr>
                                    <tr>
                                      <th>Status:</th>
                                      <td>
                                        <ng-container
                                          *ngFor="
                                            let status of item
                                              | dsSetItemStatusList
                                          "
                                        >
                                          <span class="badge badge-secondary">{{
                                            status | titlecase
                                          }}</span>
                                        </ng-container>
                                      </td>
                                    </tr>
                                  </tbody>
                                </table>
                              </td>
                              <td>
                                <table class="table table-borderless small">
                                  <tbody>
                                    <tr>
                                      <th>Title:</th>
                                      <td>
                                        <ng-container
                                          *ngFor="
                                            let title of getItemTitle(
                                              item.metadata
                                            )
                                          "
                                        >
                                          <span>{{ title | titlecase }}</span>
                                        </ng-container>
                                      </td>
                                    </tr>
                                    <tr>
                                      <th>Author:</th>
                                      <td>
                                        <ng-container
                                          *ngFor="
                                            let author of getAuthor(
                                              item.metadata
                                            )
                                          "
                                        >
                                          <span>{{ author | titlecase }}</span>
                                        </ng-container>
                                      </td>
                                    </tr>
                                    <tr>
                                      <th>Date issued:</th>
                                      <td>
                                        <ng-container
                                          *ngFor="
                                            let date of getDateIssued(
                                              item.metadata
                                            )
                                          "
                                        >
                                          <span>{{ date }}</span>
                                        </ng-container>
                                      </td>
                                    </tr>
                                    <tr>
                                      <th>Type:</th>
                                      <td>
                                        <ng-container
                                          *ngFor="
                                            let type of getType(item.metadata)
                                          "
                                        >
                                          <span>{{ type }}</span>
                                        </ng-container>
                                      </td>
                                    </tr>
                                  </tbody>
                                </table>
                              </td>
                              <td>
                                <div
                                  class="btn-group btn-group-sm"
                                  role="group"
                                  aria-label="btn-grp-01-01"
                                >
                                  <button
                                    class="btn btn-danger"
                                    title="Delete"
                                    (click)="
                                      $event.preventDefault();
                                      confirmDelete(
                                        content,
                                        item.uuid,
                                        'item',
                                        set.setChecksum,
                                        set.id
                                      )
                                    "
                                  >
                                    <i class="fa fa-trash-alt"></i>
                                  </button>
                                  <!-- <button
                                  class="btn btn-warning"
                                  title="Keep this"
                                >
                                  <i class="fa fa-star"></i>
                                </button> -->
                                </div>
                              </td>
                            </tr>
                          </ng-container>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </ng-container>
            </ng-template>
          </ngb-panel>
        </ng-container>
      </ngb-accordion>
    </div>
  </div>
</div>

<ng-template #content let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title text-danger">{{ "Remove Element" | translate }}</h4>
    <button
      type="button"
      class="close"
      aria-label="Close"
      (click)="d('cancel')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p>{{ "submission.sections.upload.delete.confirm.info" | translate }}</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="c('cancel')">
      {{ "submission.sections.upload.delete.confirm.cancel" | translate }}
    </button>
    <button type="button" class="btn btn-danger" (click)="c('ok')">
      {{ "submission.sections.upload.delete.confirm.submit" | translate }}
    </button>
  </div>
</ng-template>
